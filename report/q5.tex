\section{问题五的模型的建立和求解}
\subsection{问题五的描述与分析}

本问在第四问的异构网络场景和QoS评估框架基础上，引入了基站的能耗模型，旨在探索网络能耗的最小化的基础上，保障用户服务质量。这是一个典型的两阶段多目标优化问题。为此，我们设计了一个两阶段的优化求解框架。

\subsection{预备工作}
本问的集合、索引与大部分参数均与第四问保持一致。
\begin{itemize}
    \item 基站集合：$\bar{\mathcal{N}}=\{0\}\cup\mathcal{N}$，其中 $0$ 表示 MBS，$\mathcal{N}=\{1,2,3\}$ 表示 SBS 集合。
    \item 切片集合：$\mathcal{S}=\{U,e,m\}$。
    \item 用户集合：$\mathcal{K}=\mathcal{K}_U\cup\mathcal{K}_e\cup\mathcal{K}_m$。
    \item 决策时刻集合：$\mathcal{T}=\{0,100,\dots,900\}$ ms。
\end{itemize}

新增的能耗模型相关参数（基于附录6）如下：
\begin{itemize}
    \item 固定功耗：$P_{static} = 28\,\mathrm{W}$。
    \item 每RB激活功耗系数：$\delta = 0.75\,\mathrm{W/RB}$。
    \item 功率放大器效率：$\eta = 0.35$。
\end{itemize}

\subsection{模型建立}

\subsubsection{能耗模型}

基于附录6，每个基站 $n \in \bar{\mathcal{N}}$ 在任意时刻 $\tau$ 的总功耗 $P_n(\tau)$ 由三部分组成：
\begin{equation}
P_n(\tau) = P_{static} + P_{RB,n}(\tau) + P_{tx,n}(\tau)
\end{equation}
其中：
\begin{itemize}
  \item \textbf{固定功耗} $P_{static}$：基站基础运行所需功耗。
  \item \textbf{RB激活功耗} $P_{RB,n}(\tau) = \delta \cdot N_{active,n}(\tau)$，与该时刻激活的RB总数 $N_{active,n}(\tau)$ 成正比。$N_{active,n}(\tau)$ 是基站 $n$ 在时刻 $\tau$ 上服务所有用户的RB数量之和。
  \item \textbf{发射功耗} $P_{tx,n}(\tau) = \frac{1}{\eta} P_{transmit,n}(\tau)$，与总发射功率 $P_{transmit,n}(\tau)$ 成正比。$P_{transmit,n}(\tau)$ 是基站 $n$ 在时刻 $\tau$ 上服务所有用户的发射功率之和，单位为瓦特(W)。
\end{itemize}
全网在时刻 $\tau$ 的总功耗为 $P_{total}(\tau) = \sum_{n\in\bar{\mathcal{N}}} P_n(\tau)$。在一个决策窗口 $t$（时长为 $T_w=100$ms）内的总能耗（单位：焦耳）为：
\begin{equation}
E_{total}(t) = \int_{t}^{t+T_w} P_{total}(\tau) d\tau
\end{equation}

\subsubsection{两阶段优化模型}

为实现“优先最小化能耗，再最大化QoS”的目标，我们将原问题分解为两个独立的子问题，在每个决策窗口 $t \in \mathcal{T}$ 内依次进行优化。该方法的核心思想是，首先在满足基本通信需求的前提下，确定最优的节能功率配置；然后在此功率配置下，通过精细化的资源块（RB）分配来最大化用户服务质量（QoS）\upcite{TXXB202305020}。

\paragraph{第一阶段：能耗最小化}
此阶段的核心目标是，在用户接入和RB分配策略固定的情况下，通过调整各基站各切片的发射功率，找到使得窗口总能耗 $E_{total}(t)$ 最小的功率分配方案 $\{p_{n,s}(t)\}$。
该阶段的优化模型可表述为：
\begin{equation}
\begin{aligned}
\min_{\{p_{n,s}(t)\}} \quad & E_{total}\left(t; \{p_{n,s}(t)\}\right) \\
\text{s.t.} \quad & 
\left\{
\begin{aligned}
& 10 \le p_{0,s}(t) \le 40, \quad \forall s \in \mathcal{S} \\
& 10 \le p_{n,s}(t) \le 30, \quad \forall n \in \mathcal{N}, s \in \mathcal{S}
\end{aligned}
\right.
\end{aligned}
\end{equation}
决策变量仅为各基站各切片的发射功率 $p_{n,s}(t)$。
\paragraph{第二阶段：QoS最大化}
在第一阶段得到最优功率分配方案 $p^*_{n,s}(t)$ 后，此阶段的目标是在此节能功率配置下，通过优化RB的切片划分方案 $\{x_{n,s}(t)\}$，来最大化全网用户的总服务质量 $Q_{total}(t)$。
该阶段的优化模型表述为：
\begin{equation}
\begin{aligned}
\max_{\{x_{n,s}(t)\}} \quad & Q_{total}\left(t; \{x_{n,s}(t)\}, \{p^*_{n,s}(t)\}\right) \\
\text{s.t.} \quad & 
\left\{
\begin{aligned}
& \sum_{s\in\mathcal{S}} x_{n,s}(t) = R_n, \quad \forall n \in \bar{\mathcal{N}} \\
& x_{n,U}(t)\bmod 10=0, \quad \forall n \in \bar{\mathcal{N}} \\
& x_{n,e}(t)\bmod 5=0, \quad \forall n \in \bar{\mathcal{N}} \\
& x_{n,m}(t)\bmod 2=0, \quad \forall n \in \bar{\mathcal{N}} \\
& x_{n,s}(t)\in\mathbb{Z}_{\ge 0}, \quad \forall n \in \bar{\mathcal{N}}, s \in \mathcal{S}
\end{aligned}
\right.
\end{aligned}
\end{equation}
决策变量为各基站为不同业务切片分配的RB数量 $x_{n,s}(t)$。目标函数 $Q_{total}$ 的评估方式与第四问一致，均通过动态仿真得出，但此时是在给定的节能功率模式下进行。

\subsection{模型求解}

我们延续“滚动时域控制(MPC)”框架，结合第二问的枚举仿真和第三四问的遗传算法，在每个100ms的窗口内，依次执行上述两阶段优化。

\paragraph{第一阶段求解：遗传算法 (GA)}
由于能耗与功率之间存在复杂的非线性关系，且其评估依赖于精细的动态仿真，我们采用遗传算法（GA）求解第一阶段的功率优化问题。
\begin{itemize}
    \item \textbf{编码}：个体仅编码各基站各切片的功率值，为一个长度为 $4 \times 3 = 12$ 的浮点数数组。
    \item \textbf{适应度函数}：适应度被定义为窗口内总能耗的负值，即 $f = -E_{total}$。该能耗值通过调用一个1ms步长的仿真器，在固定的接入和RB分配下模拟整个窗口得出。
    \item \textbf{遗传算子}：采用锦标赛选择、算术交叉和高斯扰动变异。
\end{itemize}

\paragraph{第二阶段求解：枚举仿真}
该阶段方法与第二问大致相同，区别在于第四问开始增加了宏基站，在枚举时需要同时考虑宏基站和微基站的RB分配。

\subsection{结果分析}
我们采用上一节提出的两阶段优化方法对问题五进行了求解。在1000ms的总仿真时长内，实现了 \textbf{183.68 J} 的总能耗，以及 \textbf{428.60} 的总服务质量（QoS）得分。每个决策窗口的详细结果汇总于表~\ref{tab:q5_results}。

\begin{table}[H]
  \centering
  \caption{问题五各窗口资源分配决策与性能结果}
  \label{tab:q5_results}
  \resizebox{\textwidth}{!}{%
  \begin{tabular}{c|ccc|ccc|c|c}
    \toprule
    \textbf{Win} & \multicolumn{3}{c|}{\textbf{MBS\_1 (RB/P(dBm))}} & \multicolumn{3}{c|}{\textbf{SBS\_1 (RB/P(dBm))}} & \textbf{QoS} & \textbf{Energy (J)} \\
    \cmidrule(lr){2-4} \cmidrule(lr){5-7}
     & \textbf{U} & \textbf{E} & \textbf{M} & \textbf{U} & \textbf{E} & \textbf{M} & & \\
    \midrule
    0 & 0/23.9 & 0/27.1 & 100/25.1 & 10/14.9 & 10/10.0 & 30/10.0 & 95.75 & 19.68 \\
    1 & 0/27.8 & 0/21.1 & 100/17.6 & 0/21.8 & 0/10.0 & 50/10.0 & 72.13 & 18.10 \\
    2 & 0/27.9 & 0/24.5 & 100/25.6 & 0/18.7 & 0/10.0 & 50/10.0 & 40.37 & 18.12 \\
    3 & 0/29.1 & 0/25.6 & 100/27.0 & 0/17.8 & 0/10.0 & 50/10.0 & 92.88 & 18.25 \\
    4 & 0/23.8 & 0/20.5 & 100/32.0 & 0/10.0 & 0/10.0 & 50/10.0 & 61.77 & 17.97 \\
    5 & 0/25.2 & 0/30.8 & 100/18.2 & 0/10.0 & 0/10.0 & 50/10.0 & 83.54 & 18.10 \\
    6 & 0/26.8 & 0/25.6 & 100/23.2 & 0/10.0 & 10/10.0 & 40/10.0 & 13.49 & 19.48 \\
    7 & 0/21.0 & 0/24.9 & 100/34.7 & 0/10.0 & 0/10.0 & 50/10.0 & 3.64 & 18.09 \\
    8 & 0/26.6 & 0/24.4 & 100/25.0 & 0/10.0 & 0/10.0 & 50/10.0 & -11.53 & 17.84 \\
    9 & 0/29.2 & 0/31.5 & 100/35.9 & 0/10.0 & 0/10.0 & 50/10.0 & -23.45 & 18.05 \\
    \bottomrule
  \end{tabular}%
  }
  \footnotesize{\\注：表格仅展示了MBS\_1和SBS\_1的决策，完整决策见附录代码输出。}
\end{table}

\subsubsection{节能策略分析}
第一阶段的GA优化展现了智能的功率控制策略以实现节能：
\begin{itemize}
    \item \textbf{功率的精细化控制}：与问题四中功率普遍较高的设定不同，本问中的功率分配显示出极大的差异性。例如，在窗口0，SBS\_1为eMBB和mMTC切片仅分配了10.0dBm的最低功率，而在窗口5，MBS为eMBB切片分配了高达30.8dBm的功率。这表明算法并非简单地“一刀切”式降低所有功率，而是根据不同切片、不同基站的信道和业务情况，有选择地、精细地调整功率，以最小的能耗代价满足基本通信需求。
    \item \textbf{向低功耗基站/切片倾斜}：在固定RB分配下，GA倾向于为信道条件好的用户（通常离基站近）分配较低的功率，而为信道条件差的用户分配较高的功率，以保证所有用户的基本连通性。同时，对于非关键业务或负载较轻的切片，算法会果断采用最低功率策略，从而最大化节能效果。
\end{itemize}

综上，本问提出的两阶段优化框架成功地实现了在保障基本服务的前提下最小化网络能耗的目标。结果清晰地量化了能耗与服务质量之间的权衡关系，并验证了通过精细化功率控制实现节能的有效性。

